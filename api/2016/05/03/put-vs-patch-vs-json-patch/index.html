<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>PUT vs PATCH vs JSON-PATCH | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />

  <meta property="og:title" content="PUT vs PATCH vs JSON-PATCH" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="A question that is asked with increasing regularity in the APIs You Won&#x27;t Hate Slack Group is one which has been asked for years, but does not always have a good answer. The question is:" />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/api/2016/05/03/put-vs-patch-vs-json-patch/" />
  <meta property="og:locale" content="en_GB" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="PUT vs PATCH vs JSON-PATCH | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/api/2016/05/03/put-vs-patch-vs-json-patch/">
  <meta name="twitter:description" content="A question that is asked with increasing regularity in the APIs You Won&#x27;t Hate Slack Group is one which has been asked for years, but does not always have a good answer. The question is:">
  <meta name="twitter:creator" content="@philsturgeon">

  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">PUT vs PATCH vs JSON-PATCH</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2016-05-03 02:21:00 UTC">
                May  3 2016
              </time>
              <a href="/tag/api/">#api</a>
              <a href="/tag/http/">#http</a>
              <a href="/tag/rest/">#rest</a>
              <a href="/tag/patch/">#patch</a>
              <a href="/tag/json-patch/">#json-patch</a>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>A question that is asked with increasing regularity in the <a href="https://slack.apisyouwonthate.com/">APIs You Won't Hate Slack Group</a> is one which has been asked for years, but does not always have a good answer. The question is:</p>

<blockquote>
  <p>What is the different between PUT and PATCH, and when do I use them? And WTF is JSON-PATCH?</p>
</blockquote>

<p>To start off, <code>PUT</code> and <code>PATCH</code> are two different HTTP methods, which are both commonly used in REST APIs. For people who think of REST APIs as only being CRUD (Create, Read, Update, Delete) there can be confusion over trying to work out which one is "best". People have preferences, people argue, and really the conversation is rarely had in a reasonable way.</p>

<p>You can totally have both <code>PUT</code> and <code>PATCH</code> in your API, and no, they should not be an alias of each other (looking at you Rails). Quite simply, they do different things. The RFC for <code>PATCH</code> (<a href="https://tools.ietf.org/html/rfc5789">RFC 5789</a>) actually explains the difference rather elegantly in its abstract:</p>

<blockquote>
  <p>The existing HTTP PUT method only allows a complete replacement of a document. This proposal adds a new HTTP method, PATCH, to modify an existing HTTP resource.</p>
</blockquote>

<p>One is for when you know <em>all</em> the answers, and the other is for updating little bits at a time. Some consider this a performance benefit (sending less stuff is quicker than sending lots of stuff), but there are some more racy benefits than that.</p>

<h2 id="conflicts">Conflicts</h2>

<p>Think about a resource that has two fields, <code>field1</code> and <code>field2</code>. Two different requests (Request A and (Request B) try to update one of these field values as a <code>PUT</code> after getting the initial value of the resource with a <code>GET</code> request. Both <code>field1</code> and <code>field2</code> are <code>false</code> in response of the <code>GET</code> request.</p>

<p><strong>Request A</strong></p>

<p>Updating <code>field1</code> to be <code>true</code>.</p>

<pre class="highlight http"><code><span class="err">PUT /foos/123

{
  "field1": true,
  "field2": false
}
</span></code></pre>

<p><strong>Request B</strong></p>

<p>Updating <code>field2</code> to be <code>true</code>.</p>

<pre class="highlight plaintext"><code>PUT /foos/123

{
  "field1": false,
  "field2": true
}
</code></pre>

<p>If both fields start <code>false</code>, and each request only intends to update one field, little do they know they are clobbering the results and essentially reverting them each time. Instead of ending up with both values being <code>true</code>, you'll simply have whatever the last request was, which is going to be <code>"field1": false</code> and <code>"field2": true</code>.</p>

<p>To some this is a feature, but others consider it a bug because if they only want to update one field, why do they need to send everything?</p>

<p>These people decide to just send the relevant fields they want to change, which is a flagrant misuse of how <code>PUT</code> is supposed to work and leads to a lot of problems.</p>

<h2 id="expectations">Expectations</h2>

<p>When building an API, you and your coworkers are not the only people that need to have fair expectations of how things are going to work. Other systems, such as EmberJS for example, are going to have some expectations of how a <code>PUT</code> request is going to work, and if you start going against the grain and making <code>PUT</code> send partial updates, you're going to have a bad time.</p>

<p>We had a case at work, where an EmberJS application only had some models representing existing resources in the API, that were populated locally from partial data. They wanted to change the value of one field in this model and save the resource back to the API.</p>

<p>When they saved, EmberData would notice it was a <code>PUT</code> and try to send as much data as it could. As it only had some of the field values, it would end up sending a body with every unknown field as <code>null</code>, which in turn was emptying values out of the database, and/or triggering validation errors for fields that it didn't want emptied.</p>

<h2 id="patching-the-problem">PATCHing the Problem</h2>

<p>Something that helped a lot at work, was implementing <code>PATCH</code>. We can now simply send the fields we intend to update, and anything else is left alone.</p>

<p>Let's just assume we're using <a href="http://jsonapi.org/">JSON-API</a> and building something for a carpooling company, like <a href="https://ride.com/">Ride</a>. We want to be able to "start" a trip, by changing the status from <code>"pending"</code> to <code>"in_progress"</code>.</p>

<p>In v1.0, we used to use <code>PUT</code>. It worked something like this:</p>

<pre class="highlight plaintext"><code>PUT /trips/123

{
  "data": [{
    "type": "trips",
    "id": "123",
    "attributes": {
      "status": "in_progress",
      "started_at": null,
      "finished_at": null
    }
    "relationships": {
      "driver": {
        "data": { "type": "users", "id": "999" }
      }
    }
  }
}
</code></pre>

<p>Here we've changed the <code>status</code> from whatever it was to <code>in_progress</code>.</p>

<p><em><strong>Sidenote:</strong> Am I meant to update the started_at myself or let the API do it? Who knows!</em></p>

<p>The main problem here is back to the conflict example above. If somebody else was changing another value like who the driver is, and accidentally changed the <code>status</code>, back to <code>pending</code> then they'd get an error message saying "The trip has already started, it cannot go back to pending" and they'd be thinking "I didn't even know it had started, I just wanted Gary to drive today." and everyone just gets confused.</p>

<p>The same request as a <code>PATCH</code> could look something like this:</p>

<pre class="highlight plaintext"><code>PUT /trips/123

{
  "data": [{
    "type": "trips",
    "id": "123",
    "attributes": {
      "status": "in_progress"
    }
  }
}
</code></pre>

<p>This has solved the problem of not accidentally clobbering other values, as we are no longer sending things along for the sake of it. Only the attributes we send should be validated, and anything missing should be ignored entirely.</p>

<h2 id="wellactually">WellActually</h2>

<p>In RFC 5789 (the RFC for the <code>PATCH</code> method), the example shows things working like so:</p>

<pre class="highlight plaintext"><code>PATCH /file.txt HTTP/1.1
Host: www.example.com
Content-Type: application/example
If-Match: "e0023aa4e"
Content-Length: 100

[description of changes]
</code></pre>

<p>This <code>[description of changes]</code> is considered by some to be a sequence of operations to be done to the resource in question, manifesting itself in a list of JSON objects like this:</p>

<pre class="highlight plaintext"><code>PATCH /my/data HTTP/1.1
Host: example.org
Content-Length: 326
Content-Type: application/json-patch+json
If-Match: "abc123"

[
  { "op": "test", "path": "/a/b/c", "value": "foo" },
  { "op": "remove", "path": "/a/b/c" },
  { "op": "add", "path": "/a/b/c", "value": [ "foo", "bar" ] },
  { "op": "replace", "path": "/a/b/c", "value": 42 },
  { "op": "move", "from": "/a/b/c", "path": "/a/b/d" },
  { "op": "copy", "from": "/a/b/d", "path": "/a/b/e" }
]

</code></pre>

<p>This example is taken from <a href="https://tools.ietf.org/html/rfc6902">RFC 6902</a>, which builds on top of the <code>PATCH</code> method itself, to provide a standardised way of doing it. It's known as <a href="http://jsonpatch.com/">JSON PATCH</a>, and finding information about it is almost as sparse as the website.</p>

<p>There are a few articles around, but unfortunately the #WellActually starts to get pretty heavy.</p>

<p>One of the most prolific articles out there on using PATCH is from <a href="http://williamdurand.fr/2014/02/14/please-do-not-patch-like-an-idiot/">William Durand</a>. It's a great technical article, but the assertions of "do this really complicated thing which you might not need or you're Doing It Wrong" do rub me up the wrong way a bit. Read this article, consider implementing it, and if you don't want it, don't do it. You're fine.</p>

<p>Yes, <a href="https://www.mnot.net/blog/2012/09/05/patch">JSON PATCH is lovely</a>, and you might need it for your API, but it also might be a complication you don't need to worry about at this point.</p>

<p>While not the end all or be all of anything, <a href="http://jsonapi.org">JSON-API</a> used to recommend using JSON PATCH, but ended up settling on the plain "just send what you need" approach to <code>PATCH</code> which a lot of other people settle for. Something very similar to this "just send what you need" approach is being worked on as <em>yet another</em> RFC: <a href="https://tools.ietf.org/html/rfc7396">RFC 7396</a>.</p>

<p>Remember, one of the best things about HTTP-based APIs is the ability to respond to <code>Content-Type</code> headers. You can work with plain-old JSON in your <code>PATCH</code> requests for now, and in the future add JSON PATCH support if you find that you need it.</p>

<p>And you can keep <code>PUT</code> in there too, if you like the idea of having idempotent saves. We don't use them for resources at Ride anymore, but they're pretty great for <a href="/2016/01/04/http-rest-api-file-uploads/">file uploads</a> which could fail and need idempotent retries.</p>

          <hr>
<p>
  <em>I do my best writing over a cider or three, so it only stands to reason that if you like my articles and want me to continue writing, you should <a href="https://www.morallicense.com/philsturgeon/buy-me-a-cider">grab me a cheeky pint!</a></em>
</p>
<p>
  <em>P.S. If you're interested in API development, I've written a whole book called <a href="https://apisyouwonthate.com/?utm_source=philsturgeon.uk&utm_content=api-tag-footer">Build APIs You Won't Hate</a>, and it's available in ebook or paperback form! If programming books normally bore the crap out of you, this book is for you.</em>
</p>

        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=PUT vs PATCH vs JSON-PATCH&amp;url=https://philsturgeon.uk/api/2016/05/03/put-vs-patch-vs-json-patch/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=PUT vs PATCH vs JSON-PATCH&amp;u=https://philsturgeon.uk/api/2016/05/03/put-vs-patch-vs-json-patch/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/2016/03/02/loudly-ignoring-how-cocs-work/">Loudly Ignoring How CoCs Work</a>
                </p>
                <p style="float:right">
                    Next:
                    <a class="button" href="/2016/05/31/why-care-about-php-middleware/">Why Care About PHP Middleware?</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';


          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus.</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/2016/05/31/why-care-about-php-middleware/">Why Care About PHP Middleware?</a></li>
          <li><a href="/api/2016/05/03/put-vs-patch-vs-json-patch/">PUT vs PATCH vs JSON-PATCH</a></li>
          <li><a href="/2016/03/02/loudly-ignoring-how-cocs-work/">Loudly Ignoring How CoCs Work</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
